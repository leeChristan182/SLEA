<?php

namespace App\Http\Controllers;

use App\Models\AssessorCompiledScore;
use Illuminate\Support\Facades\Auth;

class AssessorCompiledScoreController extends Controller
{
    public function __construct()
    {
        $this->middleware('auth');
    }

    // GET /assessor/submissions/compiled
    public function index()
    {
        $assessor = Auth::user();
        abort_unless($assessor->isAssessor(), 403);

        $compiled = AssessorCompiledScore::with(['student.studentAcademic', 'category'])
            ->where('assessor_id', $assessor->id)
            ->orderBy('student_id')
            ->orderBy('rubric_category_id')
            ->get()
            ->groupBy('student_id');

        return view('assessor.compiled_submissions', compact('compiled'));
    }
}
